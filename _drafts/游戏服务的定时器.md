

*前四篇文章介绍了系统的定时器设计，用户层的游戏服务器定时器又应该怎样设计呢？*

游戏服务器的设计中，定时器是必不可少的一个组件。
游戏中很多逻辑都涉及到计时，例如，RPG游戏的战斗中计算角色的buff、debuff，技能的CD，在休闲类游戏中的倒计时等等。
另外服务端主动向客户端发起的请求一般是由定时器发起。

那么游戏服务器的计时架构是怎样的呢？

看过前面四篇文章后，我们很自然的想到游戏服务器的计时架构应该和系统的计时架构类似：
在固定时间间隔检查是否有定时器到期，如果有定时器到期则做出相应的处理。
原理大致相同，实现上则有所不同。
系统的计时架构有硬件的支撑，固定的时间间隔是由固定频率的定时器发起时钟中断激活。
而用户层的计时架构是在大循环内获得固定的时间间隔。  
获得固定时间间隔的实现则是百花齐放。
有通过子线程模拟硬件发起消息通知或者信号量使主线程获得固定时间间隔，
有在大循环内通过系统调用获取时间计算出固定的时间间隔等等方案。

游戏服务器的计时架构除了基础架构实现还有哪些点考虑？

1.  高效

    这个应该是定时器设计的共同目标，减少执行流的耗时，把更多的性能留给业务。

2.  随内核

    应该是至少是随内核，如果进程需要重启，定时器不会被影响。如果定时器被销毁，对于一些业务逻辑来说，是毁灭性的打击。

3.  可以调时间

    这是一个比较特殊的需求，一般的业务是不需要可以调时间的。在游戏服务器的设计中，计时架构能调整时间对测试是一个很重要的功能。